#!/bin/bash

set -e

export WORKSPACE="/workspace"
export CC="/work/llvm/bin/clang"
export CXX="/work/llvm/bin/clang++"
export CCC="/work/llvm/bin/clang++"

pushd $PWD > /dev/null
echo -n "Compiling libFuzzer..."
cd /work/libfuzzer
cp /src/llvm/lib/Fuzzer/*.h .
$CXX -g -std=c++11 -stdlib=libc++ $sanitizer_flags -c /src/llvm/lib/Fuzzer/*.cpp -I.
echo "Done."
popd > /dev/null

export CFLAGS="-g $sanitizer_flags $cov_flags"
export LIBCXX_FLAGS="-stdlib=libc++"
export CXXFLAGS="$CFLAGS $LIBCXX_FLAGS "
